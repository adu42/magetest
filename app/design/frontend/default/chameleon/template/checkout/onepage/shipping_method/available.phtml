<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php if (!($_shippingRateGroups = $this->getShippingRates())): ?>
    <p><?php echo $this->__('Sorry, no quotes are available for this order at this time.') ?></p>
<?php else: ?>
    <dl class="sp-methods">
    <dt>
    <?php $tips = array();  $errorMsg=$defaultTip=$tip=''; ?>
    <?php $k=1;$_sole = count($_shippingRateGroups) == 1;  ?>
    		<select name="shipping_method" id="shipping_method" class="required-entry">
            <?php if (!$this->getAddressShippingMethod()):?>
                <option value=""><?php echo $this->__('Please select a shipping method...') ?></option>
                <?php
                	$tips['default']=$this->__('&nbsp;');
                ?>
            <?php endif;?>
            <?php foreach ($_shippingRateGroups as $code => $rates): // foreach ($groups as $code => $rates):  ?>
                
                <?php $_sole = $_sole && count($rates) == 1;foreach ($rates as $_rate): ?>
                <?php if ($_rate->getErrorMessage()){$errorMsg=$_rate->getErrorMessage(); continue; } ?>
                    <option value="<?php echo $_rate->getCode() ?>"<?php $currentSelect=false;
					if($_rate->getCode()===$this->getAddressShippingMethod() || $_sole){ echo ' selected="selected"';$currentSelect=true;}
					else if(!$this->getAddressShippingMethod() && $k==1){
						// echo ' selected="selected"';
					//	 $currentSelect=true;
					}
					 ?>>
                        <?php 
						$methodTitle = $_rate->getMethodTitle();
						$_methodTitle=explode(':',$methodTitle);
					   echo $methodTitle=$_methodTitle[0];
						//if($_rate->getCode()===$this->getAddressShippingMethod()):
						 $tip=(isset($_methodTitle[1])?$_methodTitle[1]:'');
						  $_excl = $this->getShippingPrice($_rate->getPrice(), $this->helper('tax')->displayShippingPriceIncludingTax()); 
						   $_incl = $this->getShippingPrice($_rate->getPrice(), true); 
						    $tip.='&nbsp;&nbsp;'.$_excl; 
							 if ($this->helper('tax')->displayShippingBothPrices() && $_incl != $_excl): 
                             $tip.='('.$this->__('Incl. Tax').$_incl.')'; 
                         	 endif; 
							if(isset($_methodTitle[2]))$tip.='&nbsp;&nbsp;'.$_methodTitle[2];
						// endif;
						$tips[$_rate->getCode()]=$tip;
						if($currentSelect)$defaultTip=$tip;
						?>
                    </option>
                <?php $k++;endforeach;?>
           
            <?php endforeach;?>
            </select>
        </dt>
        <dd>
         <div id="shippingTips"><?php echo $defaultTip; ?></div>
         <img src="<?php echo $this->getSkinUrl('images/ecommerceteam/total_time.png') ?>" style="width:90%;max-width:300px">
        </dd>    
    </dl> <script>
        	var shippingTips=<?php echo json_encode($tips); ?>;
            if(e = $('shipping_method')){
    			jQuery('select[name="shipping_method"]').live('change',function(){
    					showShippingTips();
    					sendMethods('');
    			});
    		 }
             function showShippingTips(){
                var v= jQuery('#shipping_method').val();
                 if(!v){ v='default'; }
                 if(shippingTips[v] && jQuery('#shippingTips')){ jQuery('#shippingTips').html(shippingTips[v]);}
             }
        </script>
<?php endif; ?>
